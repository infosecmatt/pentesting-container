FROM kalilinux/kali-rolling:latest

#kali-linux-default is a metapackage with all tools distributed on the base kali OS
# xauth is needed for gui apps
## UPDATE 2022-11-12: I've decided to pare back this to make it faster to deploy on client environments, for now i've commented out anything related to gui stuff
RUN apt-get update -y && apt-get upgrade -y 

RUN DEBIAN_FRONTEND=noninteractive apt-get install -y kali-linux-core iputils-ping gobuster python3-pip binutils locate crackmapexec evil-winrm nmap python-is-python3 python3-impacket impacket-scripts responder smbmap python3-pip git whois
# for GUI apps run apt-get install xauth
RUN cd /opt
RUN git clone https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite.git /opt/PEASS
RUN git clone https://github.com/swisskyrepo/PayloadsAllTheThings.git /opt/PayloadsAllTheThings

#this is required for Burpsuite to effectively run
## UPDATE 2022-11-12: given disuse of GUI, burpsuite installation stuff is commented out
# RUN echo 'alias burp="java -jar /usr/bin/burpsuite --user-config-file=/pentest/config/burpsuite-user-options.json --use-defaults --config-file=/pentest/config/burpsuite-project-options.json"' >> /root/.bashrc
#support UTF encoding in tmux
RUN echo 'alias tmux="tmux -u"' >> /root/.bashrc
#hush kali login
RUN touch /root/.hushlogin

#update file database, necessary for running commands like locate
RUN updatedb
